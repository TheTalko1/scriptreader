<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theatre Line Memorization</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        const { ChevronLeft, ChevronRight, RotateCw, Eye, EyeOff, Upload, FileText } = lucide;

        const FlashcardApp = () => {
          const [allFlashcards, setAllFlashcards] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [showLine, setShowLine] = useState(false);
          const [selectedCharacter, setSelectedCharacter] = useState('');
          const [showUploadModal, setShowUploadModal] = useState(true);
          const [scriptText, setScriptText] = useState('');
          const [scriptTitle, setScriptTitle] = useState('');
          const [orderMode, setOrderMode] = useState('sequential');
          
          // Create icon components
          const ChevronLeftIcon = () => React.createElement(ChevronLeft, { className: "w-6 h-6" });
          const ChevronRightIcon = () => React.createElement(ChevronRight, { className: "w-6 h-6" });
          const RotateCwIcon = () => React.createElement(RotateCw, { className: "w-4 h-4" });
          const EyeIcon = () => React.createElement(Eye, { className: "w-5 h-5" });
          const EyeOffIcon = () => React.createElement(EyeOff, { className: "w-4 h-4" });
          const UploadIcon = () => React.createElement(Upload, { className: "w-5 h-5" });
          const FileTextIcon = () => React.createElement(FileText, { className: "w-5 h-5" });
          
          // Parse script text to extract characters and create flashcards
          const parseScript = (text) => {
            const lines = text.split('\n');
            const flashcards = [];
            let currentScene = 'Scene';
            let flashcardId = 1;
            let previousLine = '';
            let previousCharacter = '';
            let isFirstLineOfScript = true;
            
            for (let i = 0; i < lines.length; i++) {
              const line = lines[i].trim();
              
              if (!line) continue;
              
              const characterMatch = line.match(/^\*?\*?([A-Z][A-Z\s]+)\*?\*?\s*\.\s*(.+)/);
              
              if (characterMatch) {
                const character = characterMatch[1].trim();
                let dialogue = characterMatch[2].trim();
                
                dialogue = dialogue.replace(/^\*?\([^)]+\)\*?\s*/, '');
                
                if (dialogue.startsWith('*')) {
                  dialogue = dialogue.substring(1).trim();
                }
                
                let fullDialogue = dialogue;
                let j = i + 1;
                while (j < lines.length) {
                  const nextLine = lines[j].trim();
                  
                  if (!nextLine || nextLine.match(/^\*?\*?[A-Z][A-Z\s]+\*?\*?\s*\./)) {
                    break;
                  }
                  
                  if (nextLine.match(/^\*?\([^)]+\)\*?$/)) {
                    j++;
                    continue;
                  }
                  
                  fullDialogue += ' ' + nextLine.replace(/^\*/, '').trim();
                  j++;
                }
                
                fullDialogue = fullDialogue.replace(/\*+/g, '').trim();
                
                if (fullDialogue && !fullDialogue.match(/^\([^)]+\)$/)) {
                  if (isFirstLineOfScript) {
                    flashcards.push({
                      id: flashcardId++,
                      character: character,
                      cue: '<Scene opens>',
                      line: fullDialogue,
                      scene: currentScene
                    });
                    isFirstLineOfScript = false;
                  } else if (previousLine) {
                    flashcards.push({
                      id: flashcardId++,
                      character: character,
                      cue: `${previousCharacter}: ${previousLine}`,
                      line: fullDialogue,
                      scene: currentScene
                    });
                  }
                  
                  previousLine = fullDialogue;
                  previousCharacter = character;
                }
                
                i = j - 1;
              }
              else if (line.match(/^(Scene|Act|SCENE|ACT)/i)) {
                currentScene = line;
              }
            }
            
            return flashcards;
          };
          
          const handleScriptSubmit = () => {
            if (!scriptText.trim()) return;
            
            const parsed = parseScript(scriptText);
            setAllFlashcards(parsed);
            setShowUploadModal(false);
            setCurrentIndex(0);
            
            const uniqueCharacters = [...new Set(parsed.map(card => card.character))].sort();
            if (uniqueCharacters.length > 0) {
              setSelectedCharacter(uniqueCharacters[0]);
            }
          };
          
          const characters = [...new Set(allFlashcards.map(card => card.character))].sort();
          const flashcards = allFlashcards.filter(card => card.character === selectedCharacter);
          const currentCard = flashcards[currentIndex];

          const nextCard = () => {
            setShowLine(false);
            if (orderMode === 'sequential') {
              setCurrentIndex((prev) => (prev + 1) % flashcards.length);
            } else {
              if (flashcards.length > 1) {
                let newIndex;
                do {
                  newIndex = Math.floor(Math.random() * flashcards.length);
                } while (newIndex === currentIndex);
                setCurrentIndex(newIndex);
              }
            }
          };

          const prevCard = () => {
            setShowLine(false);
            if (orderMode === 'sequential') {
              setCurrentIndex((prev) => (prev - 1 + flashcards.length) % flashcards.length);
            } else {
              nextCard();
            }
          };

          const toggleLine = () => {
            setShowLine(!showLine);
          };

          const shuffleCards = () => {
            if (flashcards.length > 0) {
              setCurrentIndex(Math.floor(Math.random() * flashcards.length));
              setShowLine(false);
            }
          };

          const toggleOrderMode = () => {
            const newMode = orderMode === 'sequential' ? 'random' : 'sequential';
            setOrderMode(newMode);
            setShowLine(false);
            
            if (newMode === 'sequential') {
              setCurrentIndex(0);
            }
          };

          const handleCharacterChange = (e) => {
            setSelectedCharacter(e.target.value);
            setCurrentIndex(0);
            setShowLine(false);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-4 flex items-center justify-center">
              {showUploadModal ? (
                <div className="w-full max-w-4xl">
                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl">
                    <h1 className="text-3xl font-bold text-white text-center mb-6">
                      Upload Your Script
                    </h1>
                    
                    <div className="mb-4">
                      <label className="text-white/70 text-sm block mb-2">Script Title (optional)</label>
                      <input
                        type="text"
                        value={scriptTitle}
                        onChange={(e) => setScriptTitle(e.target.value)}
                        placeholder="e.g., The Wizard of Oz"
                        className="w-full bg-white/20 text-white px-4 py-2 rounded-lg border border-white/30 focus:outline-none focus:border-white/50 placeholder-white/50"
                      />
                    </div>
                    
                    <div className="mb-6">
                      <label className="text-white/70 text-sm block mb-2">
                        Paste your script text below
                      </label>
                      <textarea
                        value={scriptText}
                        onChange={(e) => setScriptText(e.target.value)}
                        placeholder="**CHARACTER**. Dialogue here...
**ANOTHER CHARACTER**. Their response..."
                        className="w-full h-96 bg-white/20 text-white px-4 py-3 rounded-lg border border-white/30 focus:outline-none focus:border-white/50 placeholder-white/50 font-mono text-sm"
                      />
                    </div>
                    
                    <div className="flex gap-4 justify-center">
                      <button
                        onClick={handleScriptSubmit}
                        disabled={!scriptText.trim()}
                        className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 disabled:bg-white/20 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-colors"
                      >
                        <UploadIcon />
                        Create Flashcards
                      </button>
                    </div>
                    
                    <div className="mt-6 text-white/60 text-sm">
                      <p className="mb-2">Format your script like this:</p>
                      <pre className="bg-black/30 p-3 rounded text-xs overflow-x-auto">
{`**CHARACTER**. Their dialogue here.
**ANOTHER CHARACTER**. Response to the first character.
*(Stage directions in parentheses)*
**CHARACTER**. Next line of dialogue.`}
                      </pre>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="w-full max-w-2xl">
                  <h1 className="text-4xl font-bold text-white text-center mb-4">
                    Theatre Line Memorization
                  </h1>
                  {scriptTitle && (
                    <p className="text-white/70 text-center mb-6">{scriptTitle}</p>
                  )}
                  
                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl">
                    <div className="space-y-4 mb-6">
                      <div className="flex items-center gap-4">
                        <div className="flex-1">
                          <label className="text-white/70 text-sm block mb-1">Character</label>
                          <select
                            value={selectedCharacter}
                            onChange={handleCharacterChange}
                            className="bg-white/20 text-white px-4 py-2 rounded-lg border border-white/30 focus:outline-none focus:border-white/50 w-full"
                          >
                            {characters.map(char => (
                              <option key={char} value={char} className="bg-purple-900">
                                {char}
                              </option>
                            ))}
                          </select>
                        </div>
                        
                        <button
                          onClick={() => setShowUploadModal(true)}
                          className="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg transition-colors mt-6"
                          title="Load new script"
                        >
                          <FileTextIcon />
                        </button>
                      </div>
                      
                      <div>
                        <label className="text-white/70 text-sm block mb-2">Practice Order</label>
                        <div className="flex gap-2">
                          <button
                            onClick={() => {
                              if (orderMode !== 'sequential') {
                                setOrderMode('sequential');
                                setCurrentIndex(0);
                                setShowLine(false);
                              }
                            }}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${
                              orderMode === 'sequential' 
                                ? 'bg-purple-600 text-white' 
                                : 'bg-white/20 hover:bg-white/30 text-white'
                            }`}
                          >
                            📋 Sequential
                          </button>
                          
                          <button
                            onClick={() => {
                              if (orderMode !== 'random') {
                                setOrderMode('random');
                                setShowLine(false);
                              }
                            }}
                            className={`flex-1 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 ${
                              orderMode === 'random' 
                                ? 'bg-purple-600 text-white' 
                                : 'bg-white/20 hover:bg-white/30 text-white'
                            }`}
                          >
                            🎲 Random
                          </button>
                        </div>
                        <p className="text-white/50 text-xs mt-1">
                          {orderMode === 'sequential' 
                            ? 'Going through script in order' 
                            : 'Cards presented randomly'}
                        </p>
                      </div>
                    </div>

                    {flashcards.length > 0 ? (
                      <div className="bg-white/20 backdrop-blur rounded-xl p-8 mb-6 min-h-[300px] flex flex-col justify-center">
                        <div className="text-center">
                          <p className="text-white/70 text-sm mb-2">{currentCard.scene}</p>
                          <h2 className="text-2xl font-bold text-white mb-4">{currentCard.character}</h2>
                          
                          <div className="mb-6">
                            <p className="text-white/90 text-lg italic">{currentCard.cue}</p>
                          </div>
                          
                          <div className="min-h-[100px] flex items-center justify-center">
                            {showLine ? (
                              <p className="text-white text-xl">{currentCard.line}</p>
                            ) : (
                              <button
                                onClick={toggleLine}
                                className="flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-lg transition-colors"
                              >
                                <EyeIcon />
                                Show Line
                              </button>
                            )}
                          </div>
                        </div>
                      </div>
                    ) : (
                      <div className="bg-white/20 backdrop-blur rounded-xl p-8 mb-6 min-h-[300px] flex items-center justify-center">
                        <p className="text-white/70 text-lg">
                          {allFlashcards.length === 0 
                            ? "No flashcards created yet. Try uploading a script!"
                            : "No flashcards for this character"}
                        </p>
                      </div>
                    )}

                    <div className="flex justify-between items-center mb-6">
                      <button
                        onClick={prevCard}
                        className="bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-colors"
                        disabled={flashcards.length === 0}
                        title={orderMode === 'random' ? 'Random card' : 'Previous card'}
                      >
                        <ChevronLeftIcon />
                      </button>

                      <div className="flex gap-4">
                        <button
                          onClick={shuffleCards}
                          className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2"
                          disabled={flashcards.length === 0}
                        >
                          <RotateCwIcon />
                          Jump to Random
                        </button>
                        
                        {showLine && (
                          <button
                            onClick={toggleLine}
                            className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2"
                          >
                            <EyeOffIcon />
                            Hide
                          </button>
                        )}
                      </div>

                      <button
                        onClick={nextCard}
                        className="bg-white/20 hover:bg-white/30 text-white p-3 rounded-lg transition-colors"
                        disabled={flashcards.length === 0}
                        title={orderMode === 'random' ? 'Random card' : 'Next card'}
                      >
                        <ChevronRightIcon />
                      </button>
                    </div>

                    <div className="text-center text-white/70">
                      {flashcards.length > 0 
                        ? orderMode === 'sequential'
                          ? `Card ${currentIndex + 1} of ${flashcards.length} (Sequential)`
                          : `Card ${currentIndex + 1} of ${flashcards.length} (Random)`
                        : 'No cards available'
                      }
                    </div>
                  </div>

                  <div className="mt-8 text-white/70 text-center text-sm">
                    <p>Tip: The cue shows the previous line in the script - perfect for learning your entrance timing!</p>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FlashcardApp />);
    </script>
</body>
</html>